{% extends 'base.html' %}
{% block content %}
<h2>Flight Details</h2>
    <div class="input-container">
        <label for="flight-type">Select Flight Type:</label>
        <select id="flight-type" name="flight-type">
            <option value="one-way">One-way</option>
            <option value="round-trip">Round-Trip</option>
            <option value="multi-city">Multi-city</option>
        </select>
    </div>
    <div class="input-container">
        <label for="origin">Originating Terminal:</label>
        <input type="text" id="origin" required placeholder="Leaving from" name="origin">
    </div>
    <div class="input-container">
        <label for="destination">Destination Terminal:</label>
        <input type="text" id="destination" required placeholder="Going to" name="destination">
    </div>
    <div class="input-container" id="stops-container" style="display: none;">
        <label for="stops">Stops:</label>
        <input type="text" id="stops" required name="stops">
    </div>
    <div class="input-container" id="date-from-container">
        <label for="date_from">Date From:</label>
        <input type="date" id="date_from" required name="date_from" min="2024-03-26">
    </div>
    <div class="input-container" id="date-to-container">
        <label for="date_to">Date to:</label>
        <input type="date" id="date_to" required name="date_to" min="2024-03-26">
    </div>
    <div class="input-container">
        <label for="seats">No of Traveler </label>
        <input type="text" id="seats" name="seats">
    </div>

    <div class="button-container">
        <p class="error" style="display: none;"> </p>
        <button onclick="saveDetails()">Confirm</button>
    </div>
<div>
    <h2>Flight Details</h2>
    <table>
        <tr>
            <th>Flight Type</th>
            <th>Originating Terminal</th>
            <th>Destination Terminal</th>
            <th>Stops</th>
            <th>Seats Booked/Available</th>
        </tr>
        {% for row in flight %}

         <tr>
            <td id="flight-type-display">{{ row[0] }}</td>
            <td id="origin-display">{{ row[1] }}</td>
            <td id="destination-display">{{ row[2] }}</td>
            <td id="stops-display">{{ row[3] }}</td>
            <td id="seats-display">{{ row[4] }}</td>
        </tr>

        {% endfor %}

    </table>
</div>

    <script>
    // Get references to date input fields
    var dateFromInput = document.getElementById("date_from");
    var dateToInput = document.getElementById("date_to");

    // Add event listener to "date_from" input field
    dateFromInput.addEventListener("change", function() {
        // Update the "min" attribute of "date_to" input field
        dateToInput.min = dateFromInput.value;

        // If "date_to" value is less than "date_from", reset it
        if (dateToInput.value < dateFromInput.value) {
            dateToInput.value = dateFromInput.value;
        }
    });

    // Disable previous dates
    var today = new Date().toISOString().split('T')[0];
    document.getElementById("date_from").setAttribute("min", today);

    function displayFlightDetails() {
        var flightType = document.getElementById("flight-type").value;

        // Show/hide stops input area based on flight type
        var stopsContainer = document.getElementById("stops-container");
        if (flightType === "multi-city") {
            stopsContainer.style.display = "block";
        } else {
            stopsContainer.style.display = "none";
        }
    }

    // Call the function initially
    displayFlightDetails();

    // Add event listeners to inputs
    var inputs = document.querySelectorAll('input[type="text"], select');
    inputs.forEach(input => {
        input.addEventListener('input', displayFlightDetails);
    });

    function saveDetails() {

        var flightDetails = {
            "flightType": document.getElementById("flight-type").value,
            "origin": document.getElementById("origin").value,
            "destination": document.getElementById("destination").value,
            "stops": document.getElementById("stops").value,
            "seats": document.getElementById("seats").value
        };

        // Send a POST request to the Flask endpoint
        fetch('/get_flights', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(flightDetails)
        }).then(response => {
            if (response.ok) {
                console.log('Order submitted successfully!');
                // Optionally, you can redirect the user or show a success message here
            } else {
                console.error('Failed to submit order.');
                // Handle the error case here
            }
        }).catch(error => {
            console.error('Error occurred:', error);
            // Handle any errors that occurred during the fetch operation
        });
    }
    </script>
{% endblock %}
